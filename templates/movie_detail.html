{% extends "base.html" %}

{% block title %}{{ movie.title }} - Booking4U{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-4">
        <img src="{{ movie.image_url or 'https://via.placeholder.com/300x450' }}" class="img-fluid rounded" alt="{{ movie.title }}">
    </div>
    <div class="col-md-8">
        <h2>{{ movie.title }}</h2>
        <p class="text-muted">
            {{ movie.genre }} | {{ movie.runtime }} minutes | 
            Released: {{ movie.release_date.strftime('%B %d, %Y') }}
        </p>
        {% if movie.director %}
            <p><strong>Director:</strong> {{ movie.director }}</p>
        {% endif %}
        <p class="fw-bold fs-4">${{ "%.2f"|format(movie.price) }} per ticket</p>
        
        <h5>Synopsis</h5>
        <p>{{ movie.synopsis }}</p>
        
        <h5>Cast</h5>
        <p>{{ movie.cast }}</p>

        {% if not movie.is_upcoming %}
            <a href="{{ url_for('book_ticket', movie_id=movie.id) }}" class="btn btn-danger btn-lg">Book Tickets</a>
        {% else %}
            <button class="btn btn-secondary btn-lg" disabled>Coming Soon</button>
        {% endif %}
    </div>
</div>

<hr class="my-5">

<div class="row">
    <div class="col-md-12">
        <h3>üé¨ Official Trailer</h3>

        {% set embed_url = movie.get_embed_trailer_url() %}
        
        {% if embed_url %}
            <div style="position: relative; width: 100%; height: 0; padding-bottom: 56.25%;"> 
                <iframe style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"
                        src="{{ embed_url }}" 
                        frameborder="0" 
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                        allowfullscreen>
                </iframe>
            </div>
        {% else %}
            <p class="text-muted">Trailer link not available yet.</p>
        {% endif %}
    </div>
</div>
<hr class="my-5">

<h3>Reviews ({{ reviews|length }})</h3>
<form method="POST" action="{{ url_for('add_review', movie_id=movie.id) }}" class="mb-4">
    {{ review_form.hidden_tag() }}
    <div class="row">
        <div class="col-md-2">
            {{ review_form.rating.label(class="form-label") }}
            {{ review_form.rating(class="form-control") }}
        </div>
        <div class="col-md-8">
            {{ review_form.comment.label(class="form-label") }}
            {{ review_form.comment(class="form-control", placeholder="Write your review...", rows="3") }}
        </div>
        <div class="col-md-2">
            <label class="form-label">&nbsp;</label>
            {{ review_form.submit(class="btn btn-primary w-100") }}
        </div>
    </div>
</form>
    
{% for review in reviews %}
<div class="card mb-3">
    <div class="card-body">
        <h6>{{ review.user.name }} - Rating: {{ review.rating }}/5 ‚≠ê</h6>
        <p>{{ review.comment }}</p>
        <small class="text-muted">{{ review.created_at.strftime('%B %d, %Y') }}</small>
    </div>
</div>
{% endfor %}
{% endblock %}